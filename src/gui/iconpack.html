<!DOCTYPE html>
<html data-piclet data-width="340" data-height="310">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Icon Pack</title>
  <link rel="stylesheet" href="/css/theme.css">
  <script src="/js/piclet.js"></script>
  <style>
    .platforms{display:flex;flex-direction:column;gap:4px;flex:1}
    .platforms .opt{padding:8px 10px;background:var(--bg2);border-radius:6px;border:1px solid var(--brd)}
    .platforms .opt:hover{border-color:var(--acc)}
    .platform-info{font-size:10px;color:var(--txt3);margin-left:22px;margin-top:2px}
  </style>
</head>
<body>
<div class="app">
  <div class="hd"><b>PicLet</b><span>Icon Pack Generator</span></div>
  <div class="meta">
    <div>File<b id="fn">-</b></div>
    <div>Size<b id="sz">-</b></div>
  </div>
  <!-- Form state -->
  <div id="F" class="form">
    <div class="platforms">
      <label class="opt">
        <input type="checkbox" id="cW" checked>
        <span class="box"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></span>
        Web
        <div class="platform-info">favicon, PWA, apple-touch-icon</div>
      </label>
      <label class="opt">
        <input type="checkbox" id="cA" checked>
        <span class="box"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></span>
        Android
        <div class="platform-info">mipmap folders, Play Store icon</div>
      </label>
      <label class="opt">
        <input type="checkbox" id="cI" checked>
        <span class="box"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"/></svg></span>
        iOS
        <div class="platform-info">App icons, App Store icon</div>
      </label>
    </div>
    <div class="warn-box" id="wB"></div>
    <div class="btns">
      <button class="btn btn-g" onclick="PicLet.close()">Cancel</button>
      <button class="btn btn-p" onclick="generate()">Generate</button>
    </div>
  </div>
  <!-- Loading state -->
  <div class="ld" id="L"><div class="sp"></div><span id="lT">Generating icons...</span></div>
  <!-- Log -->
  <div class="log" id="G"></div>
  <!-- Done state -->
  <div class="dn" id="D">
    <h4 id="dT"></h4>
    <p id="dM"></p>
    <div class="btns" style="width:100%;margin-top:8px">
      <button class="btn btn-p" onclick="PicLet.close()">Done</button>
    </div>
  </div>
</div>
<script>
const { $, log, fetchJson, postJson } = PicLet;

// Load initial data and check for warnings
fetchJson('/api/info').then(d => {
  $('fn').textContent = d.fileName;
  $('sz').textContent = d.width + 'Ã—' + d.height;
  if (d.width < 1024 || d.height < 1024) {
    $('wB').textContent = 'Source < 1024px. Larger images produce better quality.';
    $('wB').classList.add('on');
  }
});

// Generate icons
async function generate() {
  const web = $('cW').checked;
  const android = $('cA').checked;
  const ios = $('cI').checked;

  if (!web && !android && !ios) {
    alert('Please select at least one platform');
    return;
  }

  $('F').classList.add('hide');
  $('L').classList.add('on');
  $('G').classList.add('on');

  try {
    const result = await postJson('/api/process', { web, android, ios });

    if (result.logs) {
      result.logs.forEach(l => log('G', l.type[0], l.message));
    }

    $('L').classList.remove('on');
    $('D').classList.add('on', result.success ? 'ok' : 'err');
    $('dT').textContent = result.success ? 'Done' : 'Failed';
    $('dM').textContent = result.success ? result.output : result.error;
  } catch (e) {
    log('G', 'e', e.message);
    $('L').classList.remove('on');
    $('D').classList.add('on', 'err');
    $('dT').textContent = 'Error';
    $('dM').textContent = e.message;
  }
}
</script>
</body>
</html>
